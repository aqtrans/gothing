{{ define "title" }}<title>Upload Images - {{.Page.TheName}}</title>{{ end }}
{{ define "sidebar" }}
    {{ template "sidebar_nav" . }}
    {{ template "login_form" . }}
{{ end }}
{{ define "content" }}
<ul class="accordion" data-accordion>
  <li class="accordion-navigation">
    <a href="#panel1a">Upload a local image</a>
    <div id="panel1a" class="content active">
        <h1>Upload an image</h1>
        <hr />
        <form action="/api/image/new" method="post" enctype="multipart/form-data" class="dropzone" id="iup">
        <div class="row collapse">
          <div class="small-6 columns">
            <input type="text" name="local-image-name" placeholder="Optional filename">
          </div>
          <div class="small-4 columns">
            <label for="file">Filename:</label>
            <input type="file" name="file" id="file">
          </div>
          <div class="small-2 columns">
            <input type="submit" name="submit" value="Submit" class="button success">
          </div>
        </div>
        </form>
    </div>
  </li>
  <li class="accordion-navigation">
    <a href="#panel2a">Upload a remote image</a>
    <div id="panel2a" class="content">
        <h1>Upload an image from a remote URL</h1>
        <hr />
        <form method="post" action="/api/image/remote" id="rup">
        <div class="row collapse">
          <div class="small-6 columns">
            <input type="text" name="remote-image" placeholder="Enter your URL...">
          </div>
          <div class="small-4 columns">
            <input type="text" name="remote-image-name" placeholder="Optional filename">
          </div>    
          <div class="small-2 columns">
            <input type="submit" name="submit" value="Submit" class="button success postfix">
          </div>
        </div>
        </form>
    </div>
  </li>
</ul>
<script type="text/javascript">
$(document).ready(function(){
  $("#iup").submit(function(event){
    event.preventDefault();
    $.ajax( {
      url: '/api/image/new',
      type: 'POST',
      data: new FormData( this ),
      processData: false,
      contentType: false,
      success: function(data){
        var splitdata = data.split("|")
        if(splitdata[0]=='success'){
          $(".alerts").append("<div class=\"alert-box success\" data-alert><a style='color:#fff' href=/i/"+splitdata[1]+"><i class='fa fa-link'></i>Link</a><a class=\"close\">&times;</a></div>");
          $("#login-form").remove();
        $(document).foundation('alert','reflow');
        } else if(splitdata[0]=='fail'){
          $(".alerts").append("<div class=\"alert-box alert\" data-alert>Failed upload<a class=\"close\">&times;</a></div>");
        $(document).foundation('alert','reflow');
        }
      }
    });
  });
  $("#rup").submit(function(event){
    event.preventDefault();
    $.ajax( {
      url: '/api/image/remote',
      type: 'POST',
      data: new FormData( this ),
      processData: false,
      contentType: false,
      success: function(data){
        var splitdata = data.split("|")
        if(splitdata[0]=='success'){
          $(".alerts").append("<div class=\"alert-box success\" data-alert><a style='color:#fff' href=/i/"+splitdata[1]+"><i class='fa fa-link'></i>Link</a><a class=\"close\">&times;</a></div>");
          $("#login-form").remove();
        $(document).foundation('alert','reflow');
        } else if(splitdata[0]=='fail'){
          $(".alerts").append("<div class=\"alert-box alert\" data-alert>Failed upload<a class=\"close\">&times;</a></div>");
        $(document).foundation('alert','reflow');
        }
      }
    });
  });  
});
</script>
{{ end }}
